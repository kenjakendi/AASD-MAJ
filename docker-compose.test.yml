services:
  # XMPP Server for integration tests
  xmpp_test_server:
    image: prosody/prosody:latest
    container_name: shelter_xmpp_test
    hostname: serverhello
    environment:
      PROSODY_VIRTUAL_HOSTS: "serverhello"
      PROSODY_ADMINS: "admin@serverhello"
      PROSODY_C2S_REQUIRE_ENCRYPTION: "false"
      PROSODY_S2S_REQUIRE_ENCRYPTION: "false"
    ports:
      - "5222:5222"  # Client connections
      - "5269:5269"  # Server-to-server connections
    volumes:
      - ./prosody.cfg.lua:/etc/prosody/prosody.cfg.lua:ro
    networks:
      - shelter_test_net
    healthcheck:
      test: ["CMD", "prosodyctl", "status"]
      interval: 10s
      timeout: 5s
      retries: 5

networks:
  shelter_test_net:
    driver: bridge
